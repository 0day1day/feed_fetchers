import requests
import re
from pymemcache.client import Client

feedaddr = 'https://lists.malwarepatrol.net/cgi/getfile?receipt=f1377916320&product=8&list=smoothwall'
feedID = 'malwarepatrol'
mkey = 'fetcher_malwarepatrol:feeddata'
killchain = 'Delivery'

client = Client(('localhost', 11211))
result = client.get(mkey)

if isinstance(result, str):
	splitlines = result.split('\n')
else:
	r = requests.get(feedaddr)
	client.set(mkey, r.content, expire=7200)
	splitlines = r.content.split('\n')

seen = []
	
print('domain,feedID,killchain, description')

for x in splitlines:
	x = x.strip()
	if re.search('^#', x): continue
	if len(x) == 0: continue
	xsplit = x.split('/')
	if not re.search('[a-z,A-Z]', xsplit[0]): continue
	if not re.search('\.', xsplit[0]): continue
	if re.search('\.$', xsplit[0]): continue
	if xsplit[0] in seen: continue
	seen.append(xsplit[0])
	print("%s,%s,%s,%s" % (xsplit[0], feedID, killchain, 'Malwarepatrol exploit pages'))
	
